<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Website Testing Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Website Testing Dashboard</h1>
    <div class="input-group">
      <input type="url" id="urlInput" placeholder="Enter website URL">
      <button onclick="runTest('desktop')">Test Desktop</button>
      <button onclick="runTest('mobile')">Test Mobile</button>
    </div>

    <div id="loading" class="loading hidden">‚è≥ Running tests...</div>

    <div class="score-board" id="scoreBoard"></div>

    <div class="cards">
      <div class="card">
        <h3>Functional Tests</h3>
        <ul id="functionalResults"></ul>
      </div>
      <div class="card">
        <h3>Performance</h3>
        <ul id="performanceResults"></ul>
      </div>
    </div>
  </div>

  <script>
    async function runTest(mode) {
      const url = document.getElementById("urlInput").value;
      if (!url) {
        alert("Please enter a URL");
        return;
      }

      document.getElementById("loading").classList.remove("hidden");
      document.getElementById("scoreBoard").innerHTML = "";

      try {
        const response = await fetch("/test", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ url, mode })
        });

        const data = await response.json();
        document.getElementById("loading").classList.add("hidden");

        updateList("functionalResults", data.functional);
        updateList("performanceResults", data.performance);

        const scoreBoard = document.getElementById("scoreBoard");
        scoreBoard.innerHTML = `Overall Score (${data.mode}): <span class="score">${data.score}%</span>`;
      } catch (err) {
        document.getElementById("loading").classList.add("hidden");
        alert("Error: Could not connect to server.");
        console.error(err);
      }
    }

    function updateList(elementId, items) {
      const ul = document.getElementById(elementId);
      ul.innerHTML = "";
      items.forEach(item => {
        const li = document.createElement("li");
        li.textContent = item.text;
        li.className = item.status;
        ul.appendChild(li);
      });
    }
  </script>
</body>
</html>
