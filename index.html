<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Website Testing Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Website Testing Dashboard</h1>

    <div class="input-group">
      <input type="url" id="urlInput" placeholder="Enter website URL" />
      <button onclick="runTest('desktop')">Test Desktop</button>
      <button onclick="runTest('mobile')">Test Mobile</button>
    </div>

    <div id="loading" class="loading" style="display:none;">‚è≥ Running tests, please wait...</div>

    <div class="cards">
      <div class="card">
        <h3>Functional Tests</h3>
        <ul id="functionalResults"></ul>
      </div>
      <div class="card">
        <h3>Usability</h3>
        <ul id="usabilityResults"></ul>
      </div>
      <div class="card">
        <h3>Security</h3>
        <ul id="securityResults"></ul>
      </div>
      <div class="card">
        <h3>Performance</h3>
        <ul id="performanceResults"></ul>
      </div>
      <div class="card">
        <h3>Overall Score</h3>
        <div id="scoreBoard" class="score-board"></div>
        <div id="modeBoard" class="score-board"></div>
      </div>
    </div>
  </div>

  <script>
  async function runTest(mode) {
    const url = document.getElementById("urlInput").value;
    if (!url) {
      alert("Please enter a URL");
      return;
    }

    document.getElementById("loading").style.display = "block";

    try {
      const response = await fetch("https://website-tester-backend-5ad8.onrender.com/test", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url, mode })
      });

      const data = await response.json();
      document.getElementById("loading").style.display = "none";

      if (!response.ok) {
        // Show actual backend error details
        alert("Error: " + (data.details || data.error || "Unknown error"));
        return;
      }

      updateList("functionalResults", data.functional);
      updateList("usabilityResults", data.usability);
      updateList("securityResults", data.security);
      updateList("performanceResults", data.performance);

      renderScore(data.score, data.mode);

    } catch (err) {
      document.getElementById("loading").style.display = "none";
      alert("Frontend Error: Could not connect to server.");
      console.error("Frontend error:", err);
    }
  }

  function updateList(elementId, items) {
    const ul = document.getElementById(elementId);
    ul.innerHTML = "";
    if (!items) return;
    items.forEach(item => {
      const li = document.createElement("li");
      li.textContent = item.text;
      li.className = item.status;
      ul.appendChild(li);
    });
  }

  function renderScore(score, mode) {
    const board = document.getElementById("scoreBoard");
    board.textContent = `Score: ${score}%`;
    board.className = "score-board " + (score >= 90 ? "pass" : score >= 50 ? "warn" : "fail");

    const modeBoard = document.getElementById("modeBoard");
    modeBoard.textContent = `Mode: ${mode}`;
  }
</script>

</body>
</html>

